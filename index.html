<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Family Tree</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand__badge">üå¥</div>
      <div class="brand__text">
        <div class="brand__title">Interactive Family Tree</div>
        <div class="brand__sub">Beginner-friendly ‚Ä¢ Caribbean style ‚Ä¢ Cloud + device save</div>
      </div>
    </div>

    <button class="btn btn-ghost" id="btnHelp" type="button">Help</button>
  </header>

  <main class="wrap">
    <!-- Onboarding / Stepper -->
    <section class="card card--hero">
      <div class="hero">
        <div>
          <h1>Start Here</h1>
          <p class="muted">
            Follow these steps in order. Buttons unlock as you go.
            ‚ÄúShared Tree‚Äù is the cloud copy. ‚ÄúMy Saved‚Äù is only on this device.
          </p>
        </div>

        <div class="stepper" aria-label="Setup steps">
          <div class="step" id="step1">
            <div class="step__badge">1</div>
            <div class="step__text">
              <div class="step__title">Choose a GEDCOM file</div>
              <div class="step__hint">Example: <code>.ged</code> file exported from Ancestry/FamilySearch.</div>
            </div>
          </div>
          <div class="step" id="step2">
            <div class="step__badge">2</div>
            <div class="step__text">
              <div class="step__title">Preview & confirm</div>
              <div class="step__hint">We show counts and a sample before uploading.</div>
            </div>
          </div>
          <div class="step" id="step3">
            <div class="step__badge">3</div>
            <div class="step__text">
              <div class="step__title">Save / Share</div>
              <div class="step__hint">Save to device or update the shared (cloud) tree.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Actions -->
    <section class="grid">
      <section class="card">
        <div class="card__titleRow">
          <h2>Get the Family Tree</h2>
          <span class="pill">Cloud + Device</span>
        </div>

        <div class="actions">
          <button class="btn btn-secondary" id="btnLoadShared" type="button">
            Load Shared Tree
          </button>

          <button class="btn" id="btnLoadLocal" type="button">
            Load My Saved (This Device)
          </button>

          <button class="btn btn-danger" id="btnClearLocal" type="button">
            Clear My Saved
          </button>
        </div>

        <p class="muted small">
          Tip: Use <strong>Load Shared Tree</strong> first if you want the latest cloud copy.
        </p>
      </section>

      <section class="card">
        <div class="card__titleRow">
          <h2>Upload a GEDCOM</h2>
          <span class="pill pill--sun">Step 1</span>
        </div>

        <label class="field">
          <span class="field__label">Choose your GEDCOM file</span>
          <input id="fileInput" type="file" accept=".ged,.txt" />
          <span class="field__help">If your file is huge, this may take a moment.</span>
        </label>

        <div class="actions">
          <button class="btn btn-primary" id="btnPreview" type="button" disabled>
            Preview File
          </button>
        </div>
      </section>
    </section>

    <!-- Preview -->
    <section class="card" id="previewCard" hidden>
      <div class="card__titleRow">
        <h2>Preview</h2>
        <span class="pill pill--ocean">Step 2</span>
      </div>

      <div class="previewGrid">
        <div class="previewBox">
          <div class="previewBox__title">Counts</div>
          <div class="previewBox__body" id="counts"></div>
        </div>

        <div class="previewBox">
          <div class="previewBox__title">Sample (first people)</div>
          <pre class="code" id="sample"></pre>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-secondary" id="btnUploadShared" type="button" disabled>
          Update Shared Tree (Cloud)
        </button>

        <button class="btn" id="btnSaveLocal" type="button" disabled>
          Save to My Device
        </button>

        <button class="btn btn-ghost" id="btnCancelPreview" type="button">
          Cancel
        </button>
      </div>

      <p class="muted small">
        Cloud save updates the shared tree for everyone who loads the shared copy.
      </p>
    </section>

    <!-- Current Status / Exports -->
    <section class="card">
      <div class="card__titleRow">
        <h2>Current Tree</h2>
        <span class="pill pill--palm" id="treeSourcePill">Not loaded</span>
      </div>

      <div class="statusRow">
        <div class="statusItem">
          <div class="statusItem__label">People</div>
          <div class="statusItem__value" id="statPeople">‚Äî</div>
        </div>
        <div class="statusItem">
          <div class="statusItem__label">Families</div>
          <div class="statusItem__value" id="statFamilies">‚Äî</div>
        </div>
        <div class="statusItem">
          <div class="statusItem__label">Surnames</div>
          <div class="statusItem__value" id="statSurnames">‚Äî</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnExportJson" type="button" disabled>Export JSON</button>
        <button class="btn" id="btnExportCsv" type="button" disabled>Export CSV</button>
        <button class="btn btn-danger" id="btnClearLoaded" type="button" disabled>Clear Loaded Tree</button>
      </div>
    </section>
  </main>

  <!-- Help Drawer -->
  <dialog class="help" id="helpDialog">
    <div class="help__header">
      <h3>How to use this app (Beginner guide)</h3>
      <button class="btn btn-ghost" id="btnCloseHelp" type="button">Close</button>
    </div>

    <div class="help__content">
      <ol>
        <li><strong>Load Shared Tree</strong> to see what‚Äôs already in the cloud.</li>
        <li>To add new data: <strong>Choose File ‚Üí Preview ‚Üí Update Shared Tree</strong>.</li>
        <li><strong>Save to My Device</strong> keeps a copy only on this computer.</li>
        <li>If something looks wrong, click <strong>Cancel</strong> during preview.</li>
      </ol>

      <div class="callout">
        <div class="callout__title">Troubleshooting</div>
        <ul>
          <li>If upload fails: check Netlify env vars and redeploy.</li>
          <li>If shared load returns empty: shared row may not exist yet‚Äîupload once.</li>
        </ul>
      </div>
    </div>
  </dialog>

  <!-- Toast -->
  <div class="toast" id="toast" role="status" aria-live="polite" hidden></div>

  <!-- Confirm Modal -->
  <dialog class="confirm" id="confirmDialog">
    <h3 id="confirmTitle">Confirm</h3>
    <p id="confirmText" class="muted"></p>
    <div class="actions actions--right">
      <button class="btn btn-ghost" id="confirmCancel" type="button">Cancel</button>
      <button class="btn btn-danger" id="confirmOk" type="button">Yes, continue</button>
    </div>
  </dialog>

  <script src="./app.js"></script>
</body>
</html>
